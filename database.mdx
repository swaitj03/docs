---
title: "Database Documentation"
description: "Complete database documentation for WitsEats"
---

# Database Schema

This document describes the database schema for the restaurant management system, including table structures, relationships, and operational details.

## Overview

The schema uses PostgreSQL with UUID primary keys and automatic timestamp management.

## Table Structure

### Restaurants Table

The core table storing restaurant information:

```sql
create table if not exists public.restaurants (
  id uuid primary key default gen_random_uuid(),
  name text not null,
  description text not null default '',
  location text not null default '',
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
```

**Fields:**
- `id`: Unique identifier (UUID, auto-generated)
- `name`: Restaurant name (required)
- `description`: Restaurant description
- `location`: Restaurant location
- `created_at`: Creation timestamp
- `updated_at`: Last update timestamp

### Menus Table

Each restaurant has exactly one menu:

```sql
create table if not exists public.menus (
  id uuid primary key default gen_random_uuid(),
  restaurant_id uuid not null references public.restaurants(id) on delete cascade,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  constraint menus_one_per_restaurant unique (restaurant_id)
);
```

**Fields:**
- `id`: Unique identifier (UUID, auto-generated)
- `restaurant_id`: Foreign key to restaurants table
- `created_at`: Creation timestamp
- `updated_at`: Last update timestamp

**Constraints:**
- One menu per restaurant (unique constraint on `restaurant_id`)
- Cascade delete when restaurant is removed

### Menu Items Table

Stores individual menu items:

```sql
create table if not exists public.menu_items (
  id uuid primary key default gen_random_uuid(),
  menu_id uuid not null references public.menus(id) on delete cascade,
  name text not null,
  description text not null default '',
  price numeric(10,2) not null default 0,
  category text not null default 'General',
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
```

**Fields:**
- `id`: Unique identifier (UUID, auto-generated)
- `menu_id`: Foreign key to menus table
- `name`: Item name (required)
- `description`: Item description
- `price`: Item price (decimal with 2 decimal places)
- `category`: Item category (defaults to 'General')
- `created_at`: Creation timestamp
- `updated_at`: Last update timestamp

## Automatic Timestamp Management

### Update Trigger Function

A PostgreSQL function automatically updates the `updated_at` timestamp:

```sql
create or replace function public.set_updated_at() returns trigger
language plpgsql as $$
begin
  new.updated_at = now();
  return new;
end $$;
```

### Triggers

Triggers are applied to all tables to maintain `updated_at` timestamps:

```sql
-- Restaurants trigger
drop trigger if exists trg_restaurants_updated_at on public.restaurants;
create trigger trg_restaurants_updated_at before update on public.restaurants
for each row execute function public.set_updated_at();

-- Menus trigger
drop trigger if exists trg_menus_updated_at on public.menus;
create trigger trg_menus_updated_at before update on public.menus
for each row execute function public.set_updated_at();

-- Menu items trigger
drop trigger if exists trg_menu_items_updated_at on public.menu_items;
create trigger trg_menu_items_updated_at before update on public.menu_items
for each row execute function public.set_updated_at();
```

## Database Indexes

Performance optimization indexes for common queries:

```sql
create index if not exists idx_restaurants_name on public.restaurants (name);
create index if not exists idx_restaurants_location on public.restaurants (location);
create index if not exists idx_menu_items_name on public.menu_items (name);
create index if not exists idx_menu_items_category on public.menu_items (category);
```

## Table Relationships

### Relationship Diagram

```
Restaurants (1) ←→ (1) Menus (1) ←→ (Many) Menu Items
```

### Relationship Details

1. **Restaurant → Menu**: One-to-one relationship
   - Each restaurant has exactly one menu
   - Menu is automatically deleted when restaurant is deleted (cascade)

2. **Menu → Menu Items**: One-to-many relationship
   - Each menu can have multiple menu items
   - Menu items are automatically deleted when menu is deleted (cascade)

3. **Restaurant → Menu Items**: One-to-many relationship (through menu)
   - Each restaurant can have multiple menu items through its menu

## Data Operations

### Adding a New Restaurant

When a new restaurant is created:
1. Restaurant record is inserted with auto-generated UUID
2. Timestamps are automatically set
3. A corresponding menu should be created (enforced by application logic)

### Adding Menu Items

When menu items are added:
1. Item is linked to existing menu via `menu_id`
2. Price validation ensures positive values
3. Category defaults to 'General' if not specified

### Deleting Operations

**Cascade Deletion Behavior:**
- Deleting a restaurant → Deletes associated menu → Deletes all menu items
- Deleting a menu → Deletes all associated menu items
- Deleting a menu item → Only affects the specific item

### Update Operations

**Automatic Timestamp Updates:**
- Any update to restaurant, menu, or menu item automatically updates `updated_at`
- Triggers ensure consistency across all tables

## Best Practices

### Data Integrity
- Use UUIDs for all primary keys to avoid conflicts
- Implement proper foreign key constraints
- Use cascade deletes to maintain referential integrity

### Performance
- Indexes on frequently queried fields (name, location, category)
- Use timestamptz for timezone-aware timestamps
- Consider partitioning for large datasets

### Security
- Use `pgcrypto` extension for secure UUID generation
- Implement row-level security if needed
- Validate input data at application level